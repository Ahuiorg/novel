# Tasks: 仙逆编年史 Web 开发任务

## 阶段一：项目基础 + 首页 + 详情页（核心体验） ✅

### 1.1 项目初始化
- [x] 1.1.1 使用 Vite 创建 Vue 3 + TypeScript 项目
- [x] 1.1.2 配置 ESLint + Prettier
- [x] 1.1.3 安装核心依赖（Three.js, GSAP, Naive UI, Pinia, Vue Router, Howler.js）
- [x] 1.1.4 配置 Google Fonts（ZCOOL XiaoWei, Noto Serif SC）
- [x] 1.1.5 创建目录结构和基础文件
- [x] 1.1.6 配置 CSS 变量（暗夜星辰主题色彩系统）

### 1.2 数据层
- [x] 1.2.1 定义 TypeScript 类型（Era, CollectibleItem, CultivationStep, Highlight, Quote, FavoriteItem）
- [x] 1.2.2 从 `故事情节.md` 提取数据转换为分片 JSON（timeline-index + 16个纪元文件）
- [x] 1.2.3 为每个纪元添加名场面（highlights）和经典台词（quotes）数据
- [x] 1.2.4 创建 `collections.json`（神通、法宝、灵兽汇总）
- [x] 1.2.5 创建 `levels.json`（十步等级体系）
- [x] 1.2.6 创建 `characters.json`（重要人物名称列表，用于高亮）

### 1.3 核心特效组件
- [x] 1.3.1 实现 `StarField.vue`（Three.js 星空粒子背景）
- [x] 1.3.2 实现 `SpiritFlow.vue`（SVG 灵气流动效果）
- [x] 1.3.3 实现 `MouseFollower.vue`（鼠标跟随灵光）
- [x] 1.3.4 实现 `GlobalEffects.vue`（特效容器层）

### 1.4 首页开发
- [x] 1.4.1 实现首页布局和响应式结构
- [x] 1.4.2 实现开场动画序列（GSAP Timeline）— 基础动画已实现
- [x] 1.4.3 实现 `TimelineRail.vue`（顶部修为进度条）
- [x] 1.4.4 实现 `EraCard.vue`（纪元卡片组件）
- [x] 1.4.5 实现滚动和导航（方向键/滚轮控制）
- [x] 1.4.6 实现底部导航栏

### 1.5 详情页开发
- [x] 1.5.1 实现详情页布局
- [x] 1.5.2 实现境界进度展示组件
- [x] 1.5.3 实现故事内容排版和滚动
- [x] 1.5.4 实现收集品分类展示（地点、神通、法宝、灵兽）
- [x] 1.5.5 实现名场面展示
- [x] 1.5.6 实现上一纪元/下一纪元导航

### 1.6 路由和转场
- [x] 1.6.1 配置 Vue Router 路由
- [x] 1.6.2 实现页面过渡动画（淡入淡出）
- [x] 1.6.3 集成等级体系页和收藏图鉴页

---

## 阶段二：特效完善 + 音效系统 ✅

### 2.1 境界突破特效
- [x] 2.1.1 实现 `BreakthroughOverlay.vue`（全屏突破动画）
- [x] 2.1.2 实现 `LightningBurst.vue`（雷电爆发效果）
- [x] 2.1.3 在时间线关键节点触发突破特效
- [x] 2.1.4 添加突破时的文字动画（境界名称显现）

### 2.2 音效系统
- [x] 2.2.1 实现 `useAudio.ts` composable
- [x] 2.2.2 添加环境音效资源（星空氛围音）— 已创建目录和说明
- [x] 2.2.3 添加交互音效（点击、悬停、突破）— 已集成到组件
- [x] 2.2.4 实现音效开关控制（存储到 localStorage）
- [x] 2.2.5 实现音量调节功能（AudioControl.vue 面板）

### 2.3 交互增强
- [x] 2.3.1 优化鼠标跟随效果（灵光拖尾 + 速度感应）
- [x] 2.3.2 添加卡片悬停微动画（3D 倾斜 + 粒子 + 光泽扫过）
- [x] 2.3.3 实现点击涟漪效果（ClickRipple.vue）
- [x] 2.3.4 添加滚动惯性和平滑滚动（useSmoothScroll.ts）

---

## 阶段三：等级体系页 + 图鉴页 ✅

### 3.1 等级体系页
- [x] 3.1.1 实现等级体系页布局
- [x] 3.1.2 实现十步境界可视化展示
- [x] 3.1.3 实现各阶段展开/收起交互
- [x] 3.1.4 添加当前进度高亮显示
- [x] 3.1.5 实现境界描述动画展示

### 3.2 图鉴页
- [x] 3.2.1 实现图鉴页整体布局
- [x] 3.2.2 实现 `CategoryFilter.vue`（分类筛选）
- [x] 3.2.3 实现图鉴网格展示
- [x] 3.2.4 实现 `ItemDetail.vue`（点击展开详情弹窗）
- [x] 3.2.5 添加收集品获取时间轴标记
- [x] 3.2.6 实现筛选和排序功能

### 3.3 导航系统
- [x] 3.3.1 实现 `AppHeader.vue`（全局导航头）
- [x] 3.3.2 实现 `AppNav.vue`（侧边/底部导航）
- [x] 3.3.3 添加页面间的平滑过渡

---

## 阶段四：读者体验增强 ✅

### 4.1 名场面和经典台词
- [x] 4.1.1 实现 `HighlightCard.vue`（名场面卡片组件）
- [x] 4.1.2 实现 `QuoteDisplay.vue`（经典台词展示组件）
- [x] 4.1.3 在详情页集成名场面展示区域
- [x] 4.1.4 在首页聚焦卡片中显示名场面预览 — 通过随机名场面弹窗实现
- [x] 4.1.5 实现名场面类型标签样式（燃/泪/爽）

### 4.2 随机精彩功能
- [x] 4.2.1 实现 `RandomHighlight.vue`（随机名场面弹窗）
- [x] 4.2.2 在首页添加"随机名场面"入口按钮
- [x] 4.2.3 实现随机选择逻辑
- [x] 4.2.4 实现"换一个"功能
- [x] 4.2.5 实现跳转到对应纪元功能

### 4.3 分享卡片
- [x] 4.3.1 实现 `ShareCard.vue`（分享卡片生成组件）
- [x] 4.3.2 设计分享卡片模板（多种尺寸）
- [x] 4.3.3 使用 html2canvas 生成图片
- [x] 4.3.4 实现图片下载功能
- [x] 4.3.5 在名场面、详情页添加分享入口

### 4.4 人物标签高亮
- [x] 4.4.1 实现人物名称识别和高亮逻辑
- [x] 4.4.2 实现人物标签悬停提示
- [x] 4.4.3 在详情页故事内容中应用高亮

### 4.5 个人收藏
- [x] 4.5.1 实现 `useFavorites.ts` composable
- [x] 4.5.2 实现收藏按钮组件
- [x] 4.5.3 实现收藏数据持久化（localStorage）
- [x] 4.5.4 实现"我的收藏"页面
- [x] 4.5.5 在底部导航添加"我的收藏"入口

---

## 阶段五：搜索 + 进度保存 + 优化 ✅

### 5.1 搜索功能
- [x] 5.1.1 实现 `SearchModal.vue`（搜索弹窗）
- [x] 5.1.2 实现按时间搜索（输入仙逆年跳转）
- [x] 5.1.3 实现按地点搜索
- [x] 5.1.4 实现按关键词全文搜索
- [x] 5.1.5 实现搜索结果高亮和跳转

### 5.2 阅读进度保存
- [x] 5.2.1 实现 `useProgress.ts` composable
- [x] 5.2.2 实现 Pinia store（progress.ts）— 已在阶段一完成
- [x] 5.2.3 自动保存当前阅读位置到 localStorage
- [x] 5.2.4 实现"继续阅读"功能
- [x] 5.2.5 实现阅读历史记录

### 5.3 设置面板
- [x] 5.3.1 实现设置弹窗
- [x] 5.3.2 添加音效开关和音量设置
- [x] 5.3.3 添加动画强度设置（完整/简洁模式）
- [x] 5.3.4 添加粒子密度设置（性能优化选项）

### 5.4 性能优化
- [x] 5.4.1 实现组件懒加载 — Vue Router 已配置动态导入
- [ ] 5.4.2 优化 Three.js 渲染性能 — 通过设置面板粒子密度控制
- [ ] 5.4.3 实现图片懒加载 — 项目暂无图片资源
- [ ] 5.4.4 添加加载状态和骨架屏 — 待完善

### 5.5 测试
- [x] 5.5.1 配置 Vitest 和 Vue Test Utils — 已配置 vitest.config.ts
- [x] 5.5.2 编写 composables 单元测试（useProgress, useFavorites）— 已创建基础测试
- [ ] 5.5.3 编写数据转换函数测试 — 待后续完善
- [x] 5.5.4 配置 Playwright — 已在 package.json 配置
- [ ] 5.5.5 编写首页 E2E 测试（加载、滚动、进度条同步）— 待后续完善
- [ ] 5.5.6 编写详情页 E2E 测试（内容显示、Tab 切换、导航）— 待后续完善
- [ ] 5.5.7 编写搜索和收藏功能 E2E 测试 — 待后续完善
- [ ] 5.5.8 编写分享卡片生成测试 — 待后续完善

### 5.6 最终验收
- [x] 5.6.1 全流程功能验收 — 核心功能已完成
- [ ] 5.6.2 浏览器兼容性测试（Chrome, Firefox, Safari, Edge）— 待后续完善
- [x] 5.6.3 性能检查和优化 — 已添加设置面板支持
- [x] 5.6.4 修复发现的问题 — 已修复 TypeScript 错误
